(()=>{"use strict";class e{sunk=!1;constructor(e){this.length=e,this.health=e}getHealth(){return this.health}isSunk(){return this.sunk}hit(){this.sunk||(this.health--,this.health>0||(this.sunk=!0))}}class t{size=10;ships=[];constructor(){this.create()}create(){this.gameboard=new Array(this.size);for(let e=0;e<this.size;e++){this.gameboard[e]=new Array(this.size);for(let t=0;t<this.size;t++)this.gameboard[e][t]={ship:null,available:!0,hit:!1}}}get(){const t=new Array(this.size);for(let a=0;a<this.size;a++){t[a]=new Array(this.size);for(let s=0;s<this.size;s++){const i=this.gameboard[a][s],r=i.ship,n=i.available,l=i.hit;if(null===r){t[a][s]={ship:r,available:n,hit:l};continue}const o=new e(r.length),h=r.length-r.getHealth();for(let e=0;e<h;e++)o.hit();t[a][s]={ship:o,available:n,hit:l}}}return t}placeShip(e,t,a){const s=e.length;if(t=this.normalizePosition(s,t,a),this.positionIsAvailable(s,t,a)){this.ships.push(e);for(let i=-1;i<=s;i++)for(let r=-1;r<=1;r++){const n="horizontal"===a?i:r,l="vertical"===a?i:r,o=t[0]+n,h=t[1]+l;if(o<0||o>this.size-1||h<0||h>this.size-1)continue;const d=this.gameboard[o][h];d.available=!1,-1!==i&&i!==s&&0===r&&(d.ship=e)}}}placeShipsRandomly(e){this.create();for(let t=0;t<e.length;t++){const a=e[t],s=a.length,i=this.randomOrientation(),r=this.normalizePosition(s,this.randomPosition(),i);this.positionIsAvailable(s,r,i)?this.placeShip(a,r,i):t--}}randomPosition(){return[Math.floor(Math.random()*this.size),Math.floor(Math.random()*this.size)]}randomOrientation(){return 0===Math.floor(2*Math.random())?"horizontal":"vertical"}normalizePosition(e,t,a){let[s,i]=t;return"horizontal"===a&&s>this.size-e&&(s=this.size-e),"vertical"===a&&i>this.size-e&&(i=this.size-e),[s,i]}positionIsAvailable(e,t,a){const[s,i]=t;for(let t=0;t<e;t++){const e="horizontal"===a?t:0,r="vertical"===a?t:0;if(!this.gameboard[s+e][i+r].available)return!1}return!0}receiveAttack(e){const[t,a]=e,s=this.gameboard[t][a];return s.hit=!0,null!==s.ship&&s.ship.hit(),[t,a]}receiveRandomAttack(){let e,t,a;do{e=Math.floor(Math.random()*this.size),t=Math.floor(Math.random()*this.size),a=this.gameboard[e][t]}while(a.hit);return this.receiveAttack([e,t])}allShipsAreSunk(){if(0===this.ships.length)return!1;for(let e=0;e<this.ships.length;e++)if(!this.ships[e].isSunk())return!1;return!0}}class a{CRUISERS_AMOUNT=1;BATTLESHIPS_AMOUNT=2;DESTROYERS_AMOUNT=3;PATROL_BOATS_AMOUNT=4;CRUISER_LENGTH=5;BATTLESHIP_LENGTH=4;DESTROYER_LENGTH=3;PATROL_BOAT_LENGTH=2;gameboard=new t;constructor(){const t=[];for(let a=0;a<this.CRUISERS_AMOUNT;a++)t.push(new e(this.CRUISER_LENGTH));for(let a=0;a<this.BATTLESHIPS_AMOUNT;a++)t.push(new e(this.BATTLESHIP_LENGTH));for(let a=0;a<this.DESTROYERS_AMOUNT;a++)t.push(new e(this.DESTROYER_LENGTH));for(let a=0;a<this.PATROL_BOATS_AMOUNT;a++)t.push(new e(this.PATROL_BOAT_LENGTH));this.ships=t}}class s{player=new a;enemy=new a;playRound(e){const[t,a]=e;null!==this.getWinner()||this.enemy.gameboard.get()[t][a].hit||(this.enemy.gameboard.receiveAttack(e),this.enemy.gameboard.allShipsAreSunk()||this.player.gameboard.receiveRandomAttack())}getWinner(){return this.player.gameboard.allShipsAreSunk()?this.enemy:this.enemy.gameboard.allShipsAreSunk()?this.player:null}}class i{gameboardSize=10;playerGameboard=document.querySelector(".gameboard_player");enemyGameboard=document.querySelector(".gameboard_enemy");constructor(e){this.game=e,this.generateGameboard("player"),this.generateGameboard("enemy");const t=document.querySelectorAll(".button");this.placeShipsRandomlyBtn=t[0],this.startBtn=t[1],this.restartBtn=t[2],this.placeShipsRandomlyBtn.addEventListener("click",(()=>{this.startBtn.disabled=!1,e.player.gameboard.placeShipsRandomly(e.player.ships),this.generateGameboard("player")})),this.startBtn.addEventListener("click",(()=>{this.placeShipsRandomlyBtn.style.display="none",this.startBtn.style.display="none",this.restartBtn.style.display="inline",e.enemy.gameboard.placeShipsRandomly(e.enemy.ships),this.generateGameboard("enemy")})),this.restartBtn.addEventListener("click",(()=>{window.location.reload()})),this.enemyGameboard.addEventListener("click",(e=>{if("none"===this.restartBtn.style.display)return;const t=e.target;if(t.classList.contains("gameboard__cell_pos")){const e=JSON.parse(t.getAttribute("data-pos"));this.game.playRound(e),this.generateGameboard("player"),this.generateGameboard("enemy")}const a=this.game.getWinner();null!==a&&(a===this.game.player?alert("You win!"):alert("You lose..."))}))}generateGameboard(e){const t="player"===e?this.game.player.gameboard:this.game.enemy.gameboard,a="player"===e?this.playerGameboard:this.enemyGameboard;a.innerHTML="";const s=document.createElement("div");s.className="gameboard__cell gameboard__cell_emp",a.appendChild(s);for(let e=0;e<this.gameboardSize;e++){const t=document.createElement("div");t.className="gameboard__cell gameboard__cell_col",t.textContent=(e+1).toString(),a.appendChild(t)}for(let s=0;s<this.gameboardSize;s++){const i=document.createElement("div");i.className="gameboard__cell gameboard__cell_row",i.innerHTML=s+1+"&nbsp;",a.appendChild(i);for(let i=0;i<this.gameboardSize;i++){const r=t.get()[s][i],n=document.createElement("div");n.className="gameboard__cell gameboard__cell_pos","player"===e&&null!==r.ship&&n.classList.add("gameboard__cell_ship"),r.hit&&(n.textContent="x",null!==r.ship?n.classList.add("gameboard__cell_hit"):n.classList.add("gameboard__cell_miss")),n.setAttribute("data-pos",`[${s}, ${i}]`),a.appendChild(n)}}}}(()=>{const e=new s;new i(e)})()})();